{% extends "base.html" %}

{% block title %}{{ conta.nome }} - Brainrot Manager{% endblock %}

{% block extra_css %}
<style>
    .brainrot-item {
        transition: all 0.3s ease;
    }
    
    .brainrot-item:hover {
        transform: translateX(5px);
    }
</style>
{% endblock %}

{% block content %}
<div class="fade-in">
    <div class="mb-6">
        <a href="{{ url_for('contas_list') }}" class="text-white hover:text-yellow-200 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>Voltar
        </a>
    </div>
    
    <!-- Informações da Conta -->
    <div class="card rounded-xl shadow-xl p-8 mb-6">
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center space-x-4">
                <div class="bg-blue-100 p-4 rounded-full">
                    <i class="fas fa-user text-4xl text-blue-600"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">{{ conta.nome }}</h1>
                    {% if conta.roblox_id %}
                    <p class="text-gray-600 mt-1">
                        <i class="fas fa-id-card mr-2"></i>Roblox ID: {{ conta.roblox_id }}
                    </p>
                    {% endif %}
                </div>
            </div>
            <a href="{{ url_for('conta_edit', id=conta.id) }}" 
               class="btn-primary text-white px-6 py-3 rounded-lg font-medium hover:no-underline">
                <i class="fas fa-edit mr-2"></i>Editar
            </a>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="bg-purple-50 rounded-lg p-4">
                <p class="text-sm text-gray-600 mb-1">Total de Brainrots</p>
                <p class="text-2xl font-bold text-purple-600">{{ brainrots|length }}</p>
            </div>
            <div class="bg-orange-50 rounded-lg p-4">
                <p class="text-sm text-gray-600 mb-1">Espaços Totais</p>
                <p class="text-2xl font-bold text-orange-600">
                    {% if conta.espacos > 0 %}
                        {{ conta.espacos }}
                    {% else %}
                        <span class="text-lg">Ilimitado</span>
                    {% endif %}
                </p>
            </div>
            <div class="bg-green-50 rounded-lg p-4">
                <p class="text-sm text-gray-600 mb-1">Espaços Livres</p>
                <p class="text-2xl font-bold {% if conta.get_espacos_livres() is none or conta.get_espacos_livres() > 0 %}text-green-600{% else %}text-red-600{% endif %}">
                    {% if conta.get_espacos_livres() is none %}
                        <span class="text-lg">Ilimitado</span>
                    {% else %}
                        {{ conta.get_espacos_livres() }}
                    {% endif %}
                </p>
            </div>
            <div class="bg-blue-50 rounded-lg p-4">
                <p class="text-sm text-gray-600 mb-1">Última Atualização</p>
                <p class="text-sm font-medium text-blue-600">
                    {{ conta.data_atualizacao.strftime('%d/%m/%Y') if conta.data_atualizacao else 'N/A' }}
                </p>
            </div>
        </div>
    </div>
    
    <!-- Brainrots da Conta -->
    <div class="card rounded-xl shadow-xl p-8">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4">
            <h2 class="text-2xl font-bold text-gray-800">
            <i class="fas fa-cube mr-3 text-purple-600"></i>Brainrots desta Conta
        </h2>
            {% if conta.tem_espaco_disponivel() or conta.espacos == 0 %}
            <a href="{{ url_for('brainrot_new', conta_id=conta.id) }}" 
               class="btn-primary text-white px-4 py-2 md:px-6 md:py-3 rounded-lg font-medium hover:no-underline text-sm md:text-base">
                <i class="fas fa-plus mr-2"></i>Adicionar Brainrot
            </a>
            {% else %}
            <button disabled class="bg-gray-400 text-white px-4 py-2 md:px-6 md:py-3 rounded-lg font-medium text-sm md:text-base cursor-not-allowed">
                <i class="fas fa-ban mr-2"></i>Conta Cheia
            </button>
            {% endif %}
        </div>
        
        {% if brainrots|length > 0 %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for brainrot in brainrots %}
            <div class="brainrot-item bg-gray-50 rounded-lg p-4 cursor-pointer hover:shadow-md transition-all duration-300 card-raridade-{{ brainrot.raridade.lower().replace(' ', '-') }}"
                 onclick="window.location.href='{{ url_for('brainrot_edit', id=brainrot.id) }}?conta_id={{ conta.id }}'">
                <div class="flex items-start space-x-4 mb-3">
                    {% if brainrot.foto %}
                        {% if brainrot.foto.startswith('http') %}
                        <img src="{{ brainrot.foto }}" 
                             alt="{{ brainrot.nome }}" 
                             class="w-28 h-28 object-cover rounded-lg"
                             loading="lazy"
                             onerror="this.style.display='none'; if(this.nextElementSibling) this.nextElementSibling.style.display='flex';"
                             onload="if(this.nextElementSibling) this.nextElementSibling.style.display='none';">
                        <div class="w-28 h-28 bg-gray-300 rounded-lg items-center justify-center hidden">
                            <i class="fas fa-cube text-gray-500 text-2xl"></i>
                        </div>
                        {% else %}
                    <img src="{{ url_for('uploaded_file', filename=brainrot.foto.split('/')[-1]) }}" 
                         alt="{{ brainrot.nome }}" 
                             class="w-28 h-28 object-cover rounded-lg"
                             loading="lazy"
                             onerror="this.style.display='none'; if(this.nextElementSibling) this.nextElementSibling.style.display='flex';"
                             onload="if(this.nextElementSibling) this.nextElementSibling.style.display='none';">
                        <div class="w-28 h-28 bg-gray-300 rounded-lg items-center justify-center hidden">
                            <i class="fas fa-cube text-gray-500 text-2xl"></i>
                        </div>
                        {% endif %}
                    {% else %}
                    <div class="w-28 h-28 bg-gray-300 rounded-lg flex items-center justify-center">
                        <i class="fas fa-cube text-gray-500 text-2xl"></i>
                    </div>
                    {% endif %}
                    <div class="flex-1">
                        <h3 class="font-bold text-gray-800 mb-1">{{ brainrot.nome }}</h3>
                                <span class="inline-block px-2 py-1 rounded text-xs font-medium raridade-{{ brainrot.raridade.lower().replace(' ', '-') }}">
                            {{ brainrot.raridade }}
                        </span>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-2 text-sm">
                    <div>
                        <p class="text-gray-600">Valor/s</p>
                        <p class="font-bold text-gray-800">{{ brainrot.valor_formatado if brainrot.valor_formatado else ('$' + (brainrot.valor_por_segundo | string) + '/s') }}</p>
                    </div>
                    <div>
                        <p class="text-gray-600">Qtd</p>
                        <p class="font-bold text-gray-800">{{ brainrot.quantidade }}</p>
                    </div>
                    <div>
                        <p class="text-gray-600">Eventos</p>
                        <p class="font-bold text-gray-800 text-xs">
                            {% if brainrot.get_eventos() %}
                                {{ brainrot.get_eventos()|join(', ') }}
                            {% else %}
                                Nenhum
                            {% endif %}
                        </p>
                    </div>
                    <div class="flex gap-2">
                        <a href="{{ url_for('brainrot_edit', id=brainrot.id) }}?conta_id={{ conta.id }}" 
                           class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                            <i class="fas fa-edit mr-1"></i>Editar
                        </a>
                        <button onclick="excluirInstancia({{ brainrot.id }})" 
                                class="text-red-600 hover:text-red-700 text-sm font-medium">
                            <i class="fas fa-trash mr-1"></i>Excluir
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-12">
            <i class="fas fa-cube text-6xl text-gray-400 mb-4"></i>
            <p class="text-gray-600 mb-4">Esta conta ainda não possui Brainrots associados.</p>
            <a href="{{ url_for('conta_edit', id=conta.id) }}" class="btn-primary text-white px-6 py-3 rounded-lg font-medium inline-block hover:no-underline">
                <i class="fas fa-link mr-2"></i>Associar Brainrots
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function excluirInstancia(id) {
        if (confirm('Tem certeza que deseja excluir esta instância?')) {
            $.ajax({
                url: `/api/brainrots/${id}`,
                type: 'DELETE',
                success: function() {
                    location.reload();
                },
                error: function() {
                    alert('Erro ao excluir instância');
                }
            });
        }
    }
</script>
{% endblock %}

